<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>



<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="shooter-res/js/virtualjoystick.js"></script>
    <style>

        canvas {
            cursor: none;
        }

    </style>



</head>

<body onload="initGame()">

<div style="height: 90vh; background-color: #f6f6f6; position: absolute;" id="joystickM"></div>
<div class="container text-center">
    <h1 id="conText" style="margin-top: 50px; display: none;"></h1>
</div>

<!--
<div id="joystick" style="display: inline-block; position: relative; border: 1px solid blue; width: 400px; height: 600px;"></div>
-->
<center>
    <canvas id="canvas" width="1500px" height="600px" style="border: 1px solid black;"></canvas>
</center>
<script src="shooter-res/js/bullets.js"></script>
<script src="shooter-res/js/playerPC.js"></script>
<script src="shooter-res/js/boss1.js"></script>
<script src="shooter-res/js/util.js"></script>

<script>

            var keys = {};


            /*function Enemy() {
                this.objects = [];
                this.maxID = 0;

                this.init = function(enemy) {
                    enemy.scale = 1;
                    enemy.scaleD = 0;
                    var id = -1;
                    //Search empty space
                    while(this.objects[++id] != undefined);
                    this.objects[id] = enemy;
                    if(id > this.maxID) this.maxID = id;
                }

                this.moveToPlayer = function(obj) {
                    if (player.dead) return;
                    var xToP = player.x - obj.x;
                    var yToP = player.y - obj.y;
                    var hyp = Math.sqrt(xToP * xToP + yToP * yToP);
                    var dx = xToP * obj.v / hyp;
                    var dy = yToP * obj.v / hyp;

                    obj.x += dx;
                    obj.y += dy;
                },

                    this.update = function() {
                        for(var i = 0;i <= this.maxID;i++){
                            if(this.objects[i] == undefined) continue;

                            var obj = this.objects[i];



                            if (obj.health > 0) {
                                var info = bullets.getMinInfo(obj);

                                if(info.dist <= 50 * obj.scale){
                                    info.object.remove = true;
                                    obj.health--;
                                }
                            }

                            if (obj.health <= 0) {
                                obj.opacity = (Math.floor(obj.opacity*100)-2)/100;
                                obj.scaleD += 0.2;
                                if (obj.opacity <= 0) {
                                    delete this.objects[i];
                                }
                            } else {
                                this.moveToPlayer(obj);
                            }
                            drawCircle(obj.x, obj.y, 25+obj.scaleD, "blue", obj.opacity);

                        }
                    }


            }*/



            var bullets = new Bullets();
            var spreadshots = new SpreadShot();
            var chasingEnemies = new ChasingEnemy();
            var blocking = new BlockingShot();
            var revolver = new RevolverShot();

            //var enemies = new Enemy();




            var speed = 3.5;
            var friction = 0.9;

            var canvas;
            var context;
            var requestid = "";


            function initGame() {
                canvas = document.getElementById("canvas");
                context = canvas.getContext("2d");


                document.addEventListener("keydown", keydown);
                document.addEventListener("keyup", keyup);

                context.clearRect(0, 0, canvas.width, canvas.height);

                update();
            }

            function resetGame() {
                player.reset();
                boss1.reset();
                bullets.reset();
                chasingEnemies.reset();
                blocking.reset();
                spreadshots.reset();
                revolver.reset();
            }

            function keydown(e) {
                keys[e.keyCode] = true;
            }

            function keyup(e) {
                keys[e.keyCode] = false;
            }

            function update() {
                context.clearRect(0, 0, canvas.width, canvas.height);

                /*if (keys[69]) {
                    player.reset();
                    boss1.reset();
                    bullets.reset();
                    chasingEnemies.reset();
                    blocking.reset();
                    spreadshots.reset();
                    revolver.reset();
                }*/

                player.update();
                spreadshots.update();
                boss1.update();
                blocking.update();
                revolver.update();
                bullets.update();




                chasingEnemies.update();


                player.render();

                if (gameState==win) {
                    context.fillStyle = "black";
                    context.font = "bold 50px Arial";
                    context.fillText("You Win!", 600, 300);
                    context.fillText("Try Again? [SPACE]", 480, 450);
                } else if (gameState==lose) {
                    context.fillStyle = "black";
                    context.font = "bold 50px Arial";
                    context.fillText("You Lose!", 600, 300);
                    context.fillText("Try Again? [SPACE]", 480, 450);
                }

                if ((gameState==win||gameState==lose) && keys[32]) {
                    resetGame();
                    gameState = playing;
                }


                requestid = window.requestAnimationFrame(update);
            }


            function drawCircle(x, y, r, color, opacity) {
                context.globalAlpha = opacity;
                context.beginPath();
                context.arc(x, y, r, 0, 2 * Math.PI, false);
                context.fillStyle = color;
                context.fill();
                context.globalAlpha = 1;
            }

            //initGame();
            //setup();



    // https://github.com/jeromeetienne/virtualjoystick.js
</script>



</body>
</html>
</body>
</html>